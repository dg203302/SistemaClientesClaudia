<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración de Gastos</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Iconos -->
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <!-- ############################# VISTA PRINCIPAL (DASHBOARD) ############################# -->
        <div id="view-dashboard" class="view">
            <header class="mb-8">
                <h1 class="text-3xl font-bold text-gray-900">Panel de Administración</h1>
                <p class="text-gray-500 mt-1">Gestiona tus operaciones y clientes de forma eficiente.</p>
            </header>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="md:col-span-1 bg-white p-6 rounded-2xl shadow-sm border border-gray-200 flex flex-col justify-center">
                    <h2 class="text-sm font-medium text-gray-500 mb-2">Total Adeudado General</h2>
                    <p id="total-owed" class="text-4xl font-bold text-red-600">$0.00</p>
                </div>
                <div class="md:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <button onclick="navigate('clients')" class="bg-blue-600 text-white p-6 rounded-2xl shadow-sm hover:bg-blue-700 transition-colors duration-300 flex items-center justify-center space-x-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users-2"><path d="M14 19a6 6 0 0 0-12 0"/><circle cx="8" cy="9" r="4"/><path d="M22 19a6 6 0 0 0-6-6 4 4 0 1 0 0-8"/></svg>
                        <span class="text-lg font-semibold">Ver Clientes</span>
                    </button>
                    <button onclick="openModal('modal-register-operation')" class="bg-green-600 text-white p-6 rounded-2xl shadow-sm hover:bg-green-700 transition-colors duration-300 flex items-center justify-center space-x-3">
                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-circle"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
                        <span class="text-lg font-semibold">Registrar Operación</span>
                    </button>
                </div>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-3 sm:mb-0">Operaciones Recientes</h2>
                    <div class="relative w-full sm:w-72">
                         <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        <input type="text" id="dashboard-filter" placeholder="Filtrar por nombre o teléfono..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow">
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 rounded-l-lg">Cliente</th>
                                <th scope="col" class="px-6 py-3">Tipo</th>
                                <th scope="col" class="px-6 py-3">Monto</th>
                                <th scope="col" class="px-6 py-3">Fecha</th>
                                <th scope="col" class="px-6 py-3 rounded-r-lg">Estado</th>
                            </tr>
                        </thead>
                        <tbody id="dashboard-operations-tbody"></tbody>
                    </table>
                    <p id="dashboard-no-results" class="text-center text-gray-500 py-8 hidden">No se encontraron operaciones.</p>
                </div>
            </div>
        </div>

        <!-- ############################# VISTA DE LISTA DE CLIENTES ############################# -->
        <div id="view-clients" class="view hidden">
            <header class="mb-8">
                 <button onclick="navigate('dashboard')" class="text-blue-600 hover:underline mb-4 inline-flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
                    <span>Volver al Panel</span>
                </button>
                <h1 class="text-3xl font-bold text-gray-900">Clientes</h1>
                <p class="text-gray-500 mt-1">Busca, visualiza y gestiona tus clientes.</p>
            </header>
             <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
                     <div class="relative w-full sm:w-72 mb-4 sm:mb-0">
                        <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        <input type="text" id="client-filter" placeholder="Buscar cliente..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow">
                    </div>
                    <button onclick="openModal('modal-add-client')" class="w-full sm:w-auto bg-blue-600 text-white px-5 py-2.5 rounded-lg shadow-sm hover:bg-blue-700 transition-colors duration-300 flex items-center justify-center space-x-2">
                         <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-plus"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg>
                        <span>Agregar Cliente</span>
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 rounded-l-lg">Nombre</th>
                                <th scope="col" class="px-6 py-3">Teléfono</th>
                                <th scope="col" class="px-6 py-3">Deuda Actual</th>
                                <th scope="col" class="px-6 py-3 rounded-r-lg">Acción</th>
                            </tr>
                        </thead>
                        <tbody id="clients-tbody"></tbody>
                    </table>
                     <p id="clients-no-results" class="text-center text-gray-500 py-8 hidden">No se encontraron clientes.</p>
                </div>
             </div>
        </div>

        <!-- ############################# VISTA DE DETALLE DE CLIENTE ############################# -->
        <div id="view-client-detail" class="view hidden">
             <header class="mb-8">
                 <button onclick="navigate('clients')" class="text-blue-600 hover:underline mb-4 inline-flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
                    <span>Volver a Clientes</span>
                </button>
                <h1 id="client-detail-name" class="text-3xl font-bold text-gray-900"></h1>
                <p id="client-detail-phone" class="text-gray-500 mt-1"></p>
            </header>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                    <h2 class="text-sm font-medium text-gray-500 mb-2">Total Adeudado</h2>
                    <p id="client-detail-owed" class="text-3xl font-bold text-red-600">$0.00</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                    <h2 class="text-sm font-medium text-gray-500 mb-2">Total Pagado</h2>
                    <p id="client-detail-paid" class="text-3xl font-bold text-green-600">$0.00</p>
                </div>
            </div>
             <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                <h2 class="text-xl font-bold text-gray-900 mb-6">Historial de Operaciones</h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-500">
                         <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 rounded-l-lg">Fecha</th>
                                <th scope="col" class="px-6 py-3">Tipo</th>
                                <th scope="col" class="px-6 py-3 rounded-r-lg">Monto</th>
                            </tr>
                        </thead>
                        <tbody id="client-detail-tbody"></tbody>
                    </table>
                     <p id="client-detail-no-results" class="text-center text-gray-500 py-8 hidden">Este cliente no tiene operaciones registradas.</p>
                </div>
             </div>
        </div>
    </div>
    
    <!-- ############################# MODALES ############################# -->

    <!-- Modal para Registrar Operación -->
    <div id="modal-register-operation" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
        <div class="bg-white rounded-2xl shadow-lg p-8 w-full max-w-md m-4">
             <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900">Registrar Operación</h2>
                <button onclick="closeModal('modal-register-operation')" class="text-gray-400 hover:text-gray-600">&times;</button>
            </div>
            <form id="form-register-operation">
                <div class="mb-4">
                    <label for="op-client" class="block text-sm font-medium text-gray-700 mb-1">Cliente</label>
                    <select id="op-client" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></select>
                </div>
                <div class="mb-4">
                    <label for="op-type" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Operación</label>
                    <select id="op-type" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="deuda">Fiado / Deuda</option>
                        <option value="pago">Pago</option>
                    </select>
                </div>
                <div class="mb-6">
                     <label for="op-amount" class="block text-sm font-medium text-gray-700 mb-1">Monto</label>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">$</span>
                        <input type="number" id="op-amount" step="0.01" min="0" required placeholder="0.00" class="w-full pl-7 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                 <div class="flex justify-end space-x-4">
                    <button type="button" onclick="closeModal('modal-register-operation')" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">Cancelar</button>
                    <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Guardar</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal para Agregar Cliente -->
    <div id="modal-add-client" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
        <div class="bg-white rounded-2xl shadow-lg p-8 w-full max-w-md m-4">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900">Agregar Nuevo Cliente</h2>
                <button onclick="closeModal('modal-add-client')" class="text-gray-400 hover:text-gray-600">&times;</button>
            </div>
            <form id="form-add-client">
                <div class="mb-4">
                    <label for="client-name" class="block text-sm font-medium text-gray-700 mb-1">Nombre Completo</label>
                    <input type="text" id="client-name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="mb-6">
                    <label for="client-phone" class="block text-sm font-medium text-gray-700 mb-1">Número de Teléfono</label>
                    <input type="tel" id="client-phone" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" onclick="closeModal('modal-add-client')" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">Cancelar</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Guardar Cliente</button>
                </div>
            </form>
        </div>
    </div>


    <script>
        // --- BASE DE DATOS EN MEMORIA (SIMULACIÓN) ---
        let clients = [
            { id: 1, name: 'Juan Pérez', phone: '2644123456' },
            { id: 2, name: 'María García', phone: '2645987654' },
            { id: 3, name: 'Carlos Rodriguez', phone: '2644112233' },
            { id: 4, name: 'Ana Martinez', phone: '2645445566' },
        ];
        let operations = [
            { id: 1, clientId: 1, type: 'deuda', amount: 50250.00, date: '2024-10-20' },
            { id: 2, clientId: 2, type: 'pago', amount: 15000.75, date: '2024-10-19' },
            { id: 3, clientId: 3, type: 'deuda', amount: 8900.00, date: '2024-10-19' },
            { id: 4, clientId: 4, type: 'pago', amount: 120500.00, date: '2024-10-18' },
            { id: 5, clientId: 1, type: 'pago', amount: 20000.00, date: '2024-10-17' },
            { id: 6, clientId: 2, type: 'deuda', amount: 45600.00, date: '2024-10-16' },
        ];

        // --- NAVEGACIÓN Y VISTAS ---
        function navigate(viewId, context = null) {
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
            document.getElementById(`view-${viewId}`).classList.remove('hidden');
            
            if (viewId === 'dashboard') renderDashboard();
            if (viewId === 'clients') renderClientsView();
            if (viewId === 'client-detail' && context) renderClientDetailView(context.clientId);
        }

        // --- MANEJO DE MODALES ---
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            if (modalId === 'modal-register-operation') populateClientsDropdown();
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        // --- LÓGICA DE CÁLCULO ---
        const formatCurrency = (amount) => new Intl.NumberFormat('es-AR', { style: 'currency', currency: 'ARS' }).format(amount);

        function getClientDebts(clientId) {
            return operations
                .filter(op => op.clientId === clientId && op.type === 'deuda')
                .reduce((sum, op) => sum + op.amount, 0);
        }
        
        function getClientPayments(clientId) {
            return operations
                .filter(op => op.clientId === clientId && op.type === 'pago')
                .reduce((sum, op) => sum + op.amount, 0);
        }

        function getClientBalance(clientId) {
            return getClientDebts(clientId) - getClientPayments(clientId);
        }

        // --- RENDERIZADO DE VISTAS ---

        function renderDashboard(filter = '') {
            const tbody = document.getElementById('dashboard-operations-tbody');
            const noResults = document.getElementById('dashboard-no-results');
            tbody.innerHTML = '';
            
            let totalOwed = 0;
            clients.forEach(c => totalOwed += getClientBalance(c.id));
            document.getElementById('total-owed').textContent = formatCurrency(totalOwed);

            const recentOps = [...operations].reverse().slice(0, 10);
            const searchTerm = filter.toLowerCase();
            const filteredOps = recentOps.filter(op => {
                const client = clients.find(c => c.id === op.clientId);
                return client.name.toLowerCase().includes(searchTerm) || client.phone.includes(searchTerm);
            });
            
            if (filteredOps.length === 0) {
                noResults.classList.remove('hidden');
                return;
            }
            noResults.classList.add('hidden');
            
            filteredOps.forEach(op => {
                const client = clients.find(c => c.id === op.clientId);
                const row = document.createElement('tr');
                row.className = 'bg-white border-b hover:bg-gray-50';
                const isDebt = op.type === 'deuda';
                row.innerHTML = `
                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">${client.name}</td>
                    <td class="px-6 py-4"><span class="font-semibold ${isDebt ? 'text-red-600' : 'text-green-600'}">${isDebt ? 'Deuda' : 'Pago'}</span></td>
                    <td class="px-6 py-4">${formatCurrency(op.amount)}</td>
                    <td class="px-6 py-4">${op.date}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 text-xs font-medium rounded-full ${isDebt ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'}">
                            ${isDebt ? 'Pendiente' : 'Completado'}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderClientsView(filter = '') {
            const tbody = document.getElementById('clients-tbody');
            const noResults = document.getElementById('clients-no-results');
            tbody.innerHTML = '';
            
            const searchTerm = filter.toLowerCase();
            const filteredClients = clients.filter(c => c.name.toLowerCase().includes(searchTerm) || c.phone.includes(searchTerm));

            if (filteredClients.length === 0) {
                noResults.classList.remove('hidden');
                return;
            }
            noResults.classList.add('hidden');
            
            filteredClients.forEach(client => {
                const balance = getClientBalance(client.id);
                const row = document.createElement('tr');
                row.className = 'bg-white border-b hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">${client.name}</td>
                    <td class="px-6 py-4">${client.phone}</td>
                    <td class="px-6 py-4 font-semibold ${balance > 0 ? 'text-red-600' : 'text-gray-700'}">${formatCurrency(balance)}</td>
                    <td class="px-6 py-4">
                        <button onclick="navigate('client-detail', { clientId: ${client.id} })" class="text-blue-600 hover:text-blue-800 font-semibold">Ver Detalles</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderClientDetailView(clientId) {
            const client = clients.find(c => c.id === clientId);
            if (!client) { navigate('clients'); return; }

            document.getElementById('client-detail-name').textContent = client.name;
            document.getElementById('client-detail-phone').textContent = client.phone;
            document.getElementById('client-detail-owed').textContent = formatCurrency(getClientDebts(clientId));
            document.getElementById('client-detail-paid').textContent = formatCurrency(getClientPayments(clientId));

            const tbody = document.getElementById('client-detail-tbody');
            const noResults = document.getElementById('client-detail-no-results');
            tbody.innerHTML = '';

            const clientOps = operations.filter(op => op.clientId === clientId).sort((a, b) => new Date(b.date) - new Date(a.date));

             if (clientOps.length === 0) {
                noResults.classList.remove('hidden');
                return;
            }
            noResults.classList.add('hidden');

            clientOps.forEach(op => {
                const isDebt = op.type === 'deuda';
                const row = document.createElement('tr');
                row.className = 'bg-white border-b';
                row.innerHTML = `
                    <td class="px-6 py-4">${op.date}</td>
                    <td class="px-6 py-4"><span class="font-semibold ${isDebt ? 'text-red-600' : 'text-green-600'}">${isDebt ? 'Deuda' : 'Pago'}</span></td>
                    <td class="px-6 py-4 font-semibold">${formatCurrency(op.amount)}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function populateClientsDropdown() {
            const select = document.getElementById('op-client');
            select.innerHTML = '';
            clients.forEach(c => {
                const option = document.createElement('option');
                option.value = c.id;
                option.textContent = `${c.name} (${c.phone})`;
                select.appendChild(option);
            });
        }

        // --- MANEJO DE FORMULARIOS ---
        document.getElementById('form-add-client').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('client-name').value;
            const phone = document.getElementById('client-phone').value;
            const newId = clients.length > 0 ? Math.max(...clients.map(c => c.id)) + 1 : 1;
            clients.push({ id: newId, name, phone });
            
            e.target.reset();
            closeModal('modal-add-client');
            renderClientsView();
        });

        document.getElementById('form-register-operation').addEventListener('submit', (e) => {
            e.preventDefault();
            const clientId = parseInt(document.getElementById('op-client').value);
            const type = document.getElementById('op-type').value;
            const amount = parseFloat(document.getElementById('op-amount').value);
            
            const newId = operations.length > 0 ? Math.max(...operations.map(op => op.id)) + 1 : 1;
            const date = new Date().toISOString().split('T')[0];

            operations.push({ id: newId, clientId, type, amount, date });
            
            e.target.reset();
            closeModal('modal-register-operation');
            // Actualizar la vista actual
            const currentView = document.querySelector('.view:not(.hidden)').id.split('-')[1];
            navigate(currentView, { clientId });
        });

        // --- EVENTOS DE FILTRADO ---
        document.getElementById('dashboard-filter').addEventListener('input', (e) => renderDashboard(e.target.value));
        document.getElementById('client-filter').addEventListener('input', (e) => renderClientsView(e.target.value));

        // --- INICIALIZACIÓN ---
        document.addEventListener('DOMContentLoaded', () => {
            renderDashboard();
        });
    </script>
</body>
</html>

